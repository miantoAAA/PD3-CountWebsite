<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>個別ページビューカウンタ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }
    </style>
</head>
<body>
    <h1>TABETEの利用回数</h1>
    <p>あなたはTABETEを <span id="COUNTmiru">0</span> 回利用しました。</p>

    <script>
        // LocalStorageからカウントを取得
        let COUNTkazu = localStorage.getItem('COUNTkazu');
        
        if (COUNTkazu === null) {
            COUNTkazu = 0;
        } else {
            COUNTkazu = parseInt(COUNTkazu, 10);
        }
        
        // カウントを増加
        COUNTkazu += 1;
        localStorage.setItem('COUNTkazu', COUNTkazu);
        document.getElementById('COUNTmiru').textContent = COUNTkazu;

        // ユーザー名を取得
        const userName = prompt("あなたの名前を入力してください:");

        // サーバーにアクセス回数を送信
        fetch('/api/access', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ user: userName }),
        })
            .then(response => response.json())
            .then(data => {
                console.log(`${data.user} さんの利用回数は ${data.count} 回です！`);
            })
            .catch(error => console.error('エラー:', error));

        // サーバーからランキングを取得して表示
        fetch('/api/ranking')
            .then(response => response.json())
            .then(ranking => {
                const rankingTitle = document.createElement('h2');
                rankingTitle.textContent = 'アクセスランキング';
                document.body.appendChild(rankingTitle);

                const rankingList = document.createElement('ol');
                ranking.forEach(({ user, count }) => {
                    const listItem = document.createElement('li');
                    listItem.textContent = `${user}: ${count}回`;
                    rankingList.appendChild(listItem);
                });
                document.body.appendChild(rankingList);
            })
            .catch(error => console.error('エラー:', error));
    </script>
</body>
</html>

